# Topic 7 HTTP Module

---

### **Concept**

**What is the HTTP Module?**

* The **`http` module** is a **built-in Node.js core module** used to create **web servers** and handle **HTTP requests and responses**.
* It allows Node.js to **serve web content**, **build APIs**, and **communicate over the web** using standard HTTP protocol.

---

### **Why HTTP Module?**

| Purpose                      | Explanation                                     |
| ---------------------------- | ----------------------------------------------- |
| **Serve Web Pages**          | Send HTML, JSON, or text responses to browsers. |
| **Create APIs**              | Build REST APIs without any external library.   |
| **Handle Requests**          | Detect routes, methods, and query parameters.   |
| **Foundation of Express.js** | Express internally uses this module.            |

---

### **How It Works**

1. Import `http` module.
2. Use `http.createServer()` to handle incoming requests.
3. The callback function receives `req` (request) and `res` (response) objects.
4. Use `res.write()` or `res.end()` to send data to the client.
5. Use `server.listen(port)` to start the server.

---

### **Folder Setup**

```
http-demo/
│
└── server.js
```

---

### **Code Example 1: Basic HTTP Server**

**File:** `server.js`

```js
// ===========================
// Example: Basic HTTP Server
// ===========================

const http = require('http');

// Create a basic server
const server = http.createServer((req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('Hello from Node.js HTTP Server!');
});

// Define port number
const PORT = 3000;

// Start listening on port 3000
server.listen(PORT, () => {
  console.log(`Server running at http://localhost:${PORT}`);
});
```

**Run in terminal:**

```bash
node server.js
```

**Visit in browser:**
`http://localhost:3000`

**Output:**

```
Hello from Node.js HTTP Server!
```

---

### **Code Example 2: Routing with HTTP Module**

**File:** `server.js` (updated)

```js
// ===========================
// Example: HTTP Routing
// ===========================

const http = require('http');

const server = http.createServer((req, res) => {
  // Set content type
  res.setHeader('Content-Type', 'text/plain');

  // Handle routes manually
  if (req.url === '/' && req.method === 'GET') {
    res.statusCode = 200;
    res.end('Welcome to Home Page');
  } else if (req.url === '/about' && req.method === 'GET') {
    res.statusCode = 200;
    res.end('About Us Page');
  } else if (req.url === '/api/data' && req.method === 'GET') {
    res.statusCode = 200;
    res.setHeader('Content-Type', 'application/json');
    res.end(JSON.stringify({ message: 'Hello from API', success: true }));
  } else {
    res.statusCode = 404;
    res.end('404 Page Not Found');
  }
});

const PORT = 4000;
server.listen(PORT, () => console.log(`Server running on http://localhost:${PORT}`));
```

**Run and Visit:**

* `/` → “Welcome to Home Page”
* `/about` → “About Us Page”
* `/api/data` → JSON response

---

### **Code Example 3: Serving HTML Files**

**Folder:**

```
http-demo/
│
├── server.js
└── pages/
    ├── index.html
    └── about.html
```

**File:** `pages/index.html`

```html
<h1>Home Page</h1>
<p>Welcome to the Node.js HTTP Server!</p>
```

**File:** `pages/about.html`

```html
<h1>About Page</h1>
<p>This page was served using Node’s fs + http modules.</p>
```

**File:** `server.js`

```js
// ===========================
// Example: Serving HTML Files
// ===========================

const http = require('http');
const fs = require('fs');
const path = require('path');

const server = http.createServer((req, res) => {
  let filePath = '';

  if (req.url === '/') {
    filePath = path.join(__dirname, 'pages', 'index.html');
  } else if (req.url === '/about') {
    filePath = path.join(__dirname, 'pages', 'about.html');
  } else {
    res.writeHead(404, { 'Content-Type': 'text/plain' });
    res.end('404 Not Found');
    return;
  }

  // Read and serve file
  fs.readFile(filePath, (err, content) => {
    if (err) {
      res.writeHead(500);
      res.end('Server Error');
    } else {
      res.writeHead(200, { 'Content-Type': 'text/html' });
      res.end(content);
    }
  });
});

const PORT = 5000;
server.listen(PORT, () => console.log(`Server running at http://localhost:${PORT}`));
```

**Visit in browser:**
`http://localhost:5000/about`

---

### **Mini Project: Simple REST API (without Express)**

**Goal:** Build a mini API to perform CRUD on in-memory data.

**Folder:**

```
simple-api/
│
└── server.js
```

**File:** `server.js`

```js
// ===========================
// Mini Project: Simple REST API
// ===========================

const http = require('http');

let books = [
  { id: 1, title: 'Learn Node.js', author: 'Tanish' },
  { id: 2, title: 'Master Express.js', author: 'Ryan Dahl' },
];

const server = http.createServer((req, res) => {
  res.setHeader('Content-Type', 'application/json');

  // GET all books
  if (req.url === '/books' && req.method === 'GET') {
    res.writeHead(200);
    res.end(JSON.stringify(books));

  // POST (Add a new book)
  } else if (req.url === '/books' && req.method === 'POST') {
    let body = '';

    req.on('data', chunk => (body += chunk));
    req.on('end', () => {
      const newBook = JSON.parse(body);
      books.push({ id: books.length + 1, ...newBook });
      res.writeHead(201);
      res.end(JSON.stringify({ message: 'Book added successfully', books }));
    });

  // DELETE a book (by id)
  } else if (req.url.startsWith('/books/') && req.method === 'DELETE') {
    const id = parseInt(req.url.split('/')[2]);
    books = books.filter(book => book.id !== id);
    res.writeHead(200);
    res.end(JSON.stringify({ message: 'Book deleted', books }));

  } else {
    res.writeHead(404);
    res.end(JSON.stringify({ message: 'Route not found' }));
  }
});

const PORT = 6000;
server.listen(PORT, () => console.log(`Server running on http://localhost:${PORT}`));
```

**Test with cURL or Postman:**

```bash
GET    http://localhost:6000/books
POST   http://localhost:6000/books
DELETE http://localhost:6000/books/2
```

**Output Example:**

```json
[
  { "id": 1, "title": "Learn Node.js", "author": "Tanish" },
  { "id": 2, "title": "Master Express.js", "author": "Ryan Dahl" }
]
```

---

### **Dependencies**

* No external dependencies — uses built-in `http` and `fs`.

---

### **Notes**

* HTTP servers in Node.js are **event-driven** and **non-blocking**.
* Use **status codes** (`200`, `201`, `404`, `500`) properly.
* Always set **response headers** (like `Content-Type`).
* This is the **foundation of Express.js**, which simplifies routing and middleware handling.

---
